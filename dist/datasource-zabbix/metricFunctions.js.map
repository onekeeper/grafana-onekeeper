{"version":3,"sources":["../../src/datasource-zabbix/metricFunctions.js"],"names":["addFuncDef","funcDef","params","defaultParams","category","categories","push","index","name","shortName","createFuncInstance","_","isString","message","FuncInstance","getFuncDef","getCategories","$","Transform","Aggregate","Filter","Trends","Time","Alias","Special","type","options","each","funcList","catName","sortBy","def","slice","updateText","metricFunctions","func","bindedFunc","param","i","length","Number","partial","metricExp","str","parameters","map","value","paramType","isNumeric","unshift","join","strValue","indexOf","optional","_hasMultipleParamsInString","split","partVal","idx","updateParam","trim","splice","text"],"mappings":"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","file":"metricFunctions.js","sourcesContent":["import _ from 'lodash';\r\nimport $ from 'jquery';\r\n\r\nvar index = [];\r\nvar categories = {\r\n  Transform: [],\r\n  Aggregate: [],\r\n  Filter: [],\r\n  Trends: [],\r\n  Time: [],\r\n  Alias: [],\r\n  Special: []\r\n};\r\n\r\nfunction addFuncDef(funcDef) {\r\n  funcDef.params = funcDef.params || [];\r\n  funcDef.defaultParams = funcDef.defaultParams || [];\r\n\r\n  if (funcDef.category) {\r\n    categories[funcDef.category].push(funcDef);\r\n  }\r\n  index[funcDef.name] = funcDef;\r\n  index[funcDef.shortName || funcDef.name] = funcDef;\r\n}\r\n\r\n// Transform\r\n\r\naddFuncDef({\r\n  name: 'groupBy',\r\n  category: 'Transform',\r\n  params: [\r\n    { name: 'interval', type: 'string'},\r\n    { name: 'function', type: 'string', options: ['avg', 'min', 'max', 'sum', 'count', 'median'] }\r\n  ],\r\n  defaultParams: ['1m', 'avg'],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'scale',\r\n  category: 'Transform',\r\n  params: [\r\n    { name: 'factor', type: 'float', options: [100, 0.01, 10, -1]}\r\n  ],\r\n  defaultParams: [100],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'delta',\r\n  category: 'Transform',\r\n  params: [],\r\n  defaultParams: [],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'rate',\r\n  category: 'Transform',\r\n  params: [],\r\n  defaultParams: [],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'movingAverage',\r\n  category: 'Transform',\r\n  params: [\r\n    { name: 'factor', type: 'int', options: [6, 10, 60, 100, 600] }\r\n  ],\r\n  defaultParams: [10],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'exponentialMovingAverage',\r\n  category: 'Transform',\r\n  params: [\r\n    { name: 'smoothing', type: 'float', options: [6, 10, 60, 100, 600] }\r\n  ],\r\n  defaultParams: [0.2],\r\n});\r\n\r\n// Aggregate\r\n\r\naddFuncDef({\r\n  name: 'sumSeries',\r\n  category: 'Aggregate',\r\n  params: [],\r\n  defaultParams: [],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'median',\r\n  category: 'Aggregate',\r\n  params: [\r\n    { name: 'interval', type: 'string'}\r\n  ],\r\n  defaultParams: ['1m'],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'average',\r\n  category: 'Aggregate',\r\n  params: [\r\n    { name: 'interval', type: 'string' }\r\n  ],\r\n  defaultParams: ['1m'],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'min',\r\n  category: 'Aggregate',\r\n  params: [\r\n    { name: 'interval', type: 'string' }\r\n  ],\r\n  defaultParams: ['1m'],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'max',\r\n  category: 'Aggregate',\r\n  params: [\r\n    { name: 'interval', type: 'string' }\r\n  ],\r\n  defaultParams: ['1m'],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'sum',\r\n  category: 'Aggregate',\r\n  params: [\r\n    { name: 'interval', type: 'string' }\r\n  ],\r\n  defaultParams: ['1m'],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'count',\r\n  category: 'Aggregate',\r\n  params: [\r\n    { name: 'interval', type: 'string' }\r\n  ],\r\n  defaultParams: ['1m'],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'aggregateBy',\r\n  category: 'Aggregate',\r\n  params: [\r\n    { name: 'interval', type: 'string' },\r\n    { name: 'function', type: 'string', options: ['avg', 'min', 'max', 'sum', 'count', 'median'] }\r\n  ],\r\n  defaultParams: ['1m', 'avg'],\r\n});\r\n\r\n// Filter\r\n\r\naddFuncDef({\r\n  name: 'top',\r\n  category: 'Filter',\r\n  params: [\r\n    { name: 'number', type: 'int' },\r\n    { name: 'value', type: 'string', options: ['avg', 'min', 'max', 'sum', 'count', 'median'] }\r\n  ],\r\n  defaultParams: [5, 'avg'],\r\n});\r\n\r\naddFuncDef({\r\n  name: 'bottom',\r\n  category: 'Filter',\r\n  params: [\r\n    { name: 'number', type: 'int' },\r\n    { name: 'value', type: 'string', options: ['avg', 'min', 'max', 'sum', 'count', 'median'] }\r\n  ],\r\n  defaultParams: [5, 'avg'],\r\n});\r\n\r\n// Trends\r\n\r\naddFuncDef({\r\n  name: 'trendValue',\r\n  category: 'Trends',\r\n  params: [\r\n    { name: 'type', type: 'string', options: ['avg', 'min', 'max', 'sum', 'count'] }\r\n  ],\r\n  defaultParams: ['avg'],\r\n});\r\n\r\n// Time\r\n\r\naddFuncDef({\r\n  name: 'timeShift',\r\n  category: 'Time',\r\n  params: [\r\n    { name: 'interval', type: 'string', options: ['24h', '7d', '1M', '+24h', '-24h']}\r\n  ],\r\n  defaultParams: ['24h'],\r\n});\r\n\r\n//Alias\r\n\r\naddFuncDef({\r\n  name: 'setAlias',\r\n  category: 'Alias',\r\n  params: [\r\n    { name: 'alias', type: 'string' }\r\n  ],\r\n  defaultParams: []\r\n});\r\n\r\naddFuncDef({\r\n  name: 'setAliasByRegex',\r\n  category: 'Alias',\r\n  params: [\r\n    { name: 'aliasByRegex', type: 'string' }\r\n  ],\r\n  defaultParams: []\r\n});\r\n\r\naddFuncDef({\r\n  name: 'replaceAlias',\r\n  category: 'Alias',\r\n  params: [\r\n    { name: 'regexp', type: 'string' },\r\n    { name: 'newAlias', type: 'string' }\r\n  ],\r\n  defaultParams: ['/(.*)/', '$1']\r\n});\r\n\r\n// Special\r\naddFuncDef({\r\n  name: 'consolidateBy',\r\n  category: 'Special',\r\n  params: [\r\n    { name: 'type', type: 'string', options: ['avg', 'min', 'max', 'sum', 'count'] }\r\n  ],\r\n  defaultParams: ['avg'],\r\n});\r\n\r\n_.each(categories, function(funcList, catName) {\r\n  categories[catName] = _.sortBy(funcList, 'name');\r\n});\r\n\r\nclass FuncInstance {\r\n  constructor(funcDef, params) {\r\n    this.def = funcDef;\r\n\r\n    if (params) {\r\n      this.params = params;\r\n    } else {\r\n      // Create with default params\r\n      this.params = [];\r\n      this.params = funcDef.defaultParams.slice(0);\r\n    }\r\n\r\n    this.updateText();\r\n  }\r\n\r\n  bindFunction(metricFunctions) {\r\n    var func = metricFunctions[this.def.name];\r\n    if (func) {\r\n\r\n      // Bind function arguments\r\n      var bindedFunc = func;\r\n      var param;\r\n      for (var i = 0; i < this.params.length; i++) {\r\n        param = this.params[i];\r\n\r\n        // Convert numeric params\r\n        if (this.def.params[i].type === 'int' ||\r\n            this.def.params[i].type === 'float') {\r\n          param = Number(param);\r\n        }\r\n        bindedFunc = _.partial(bindedFunc, param);\r\n      }\r\n      return bindedFunc;\r\n    } else {\r\n      throw { message: 'Method not found ' + this.def.name };\r\n    }\r\n  }\r\n\r\n  render(metricExp) {\r\n    var str = this.def.name + '(';\r\n    var parameters = _.map(this.params, function(value, index) {\r\n\r\n      var paramType = this.def.params[index].type;\r\n      if (paramType === 'int' ||\r\n          paramType === 'float' ||\r\n          paramType === 'value_or_series' ||\r\n          paramType === 'boolean') {\r\n        return value;\r\n      }\r\n      else if (paramType === 'int_or_interval' && $.isNumeric(value)) {\r\n        return value;\r\n      }\r\n\r\n      return \"'\" + value + \"'\";\r\n\r\n    }, this);\r\n\r\n    if (metricExp) {\r\n      parameters.unshift(metricExp);\r\n    }\r\n\r\n    return str + parameters.join(', ') + ')';\r\n  }\r\n\r\n  _hasMultipleParamsInString(strValue, index) {\r\n    if (strValue.indexOf(',') === -1) {\r\n      return false;\r\n    }\r\n\r\n    return this.def.params[index + 1] && this.def.params[index + 1].optional;\r\n  }\r\n\r\n  updateParam(strValue, index) {\r\n    // handle optional parameters\r\n    // if string contains ',' and next param is optional, split and update both\r\n    if (this._hasMultipleParamsInString(strValue, index)) {\r\n      _.each(strValue.split(','), function(partVal, idx) {\r\n        this.updateParam(partVal.trim(), idx);\r\n      }, this);\r\n      return;\r\n    }\r\n\r\n    if (strValue === '' && this.def.params[index].optional) {\r\n      this.params.splice(index, 1);\r\n    }\r\n    else {\r\n      this.params[index] = strValue;\r\n    }\r\n\r\n    this.updateText();\r\n  }\r\n\r\n  updateText() {\r\n    if (this.params.length === 0) {\r\n      this.text = this.def.name + '()';\r\n      return;\r\n    }\r\n\r\n    var text = this.def.name + '(';\r\n    text += this.params.join(', ');\r\n    text += ')';\r\n    this.text = text;\r\n  }\r\n}\r\n\r\nexport function createFuncInstance(funcDef, params) {\r\n  if (_.isString(funcDef)) {\r\n    if (!index[funcDef]) {\r\n      throw { message: 'Method not found ' + name };\r\n    }\r\n    funcDef = index[funcDef];\r\n  }\r\n  return new FuncInstance(funcDef, params);\r\n}\r\n\r\nexport function getFuncDef(name) {\r\n  return index[name];\r\n}\r\n\r\nexport function getCategories() {\r\n  return categories;\r\n}\r\n"]}