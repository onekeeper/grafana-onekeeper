{"version":3,"sources":["../../src/panel-triggers/migrations.js"],"names":["migratePanelSchema","panel","isEmptyPanel","schemaVersion","getSchemaVersion","CURRENT_SCHEMA_VERSION","datasources","datasource","targets","triggers","lastChangeField","ageField","infoField","scroll","hideHostsInMaintenance","_","isEmpty","each","target","defaultsDeep","DEFAULT_TARGET"],"mappings":";;;;;;;AAMO,WAASA,kBAAT,CAA4BC,KAA5B,EAAmC;AACxC,QAAIC,aAAaD,KAAb,CAAJ,EAAyB;AACvB,aAAOA,KAAP;AACD;;AAED,QAAME,gBAAgBC,iBAAiBH,KAAjB,CAAtB;AACAA,UAAME,aAAN,GAAsBE,sBAAtB;;AAEA,QAAIF,gBAAgB,CAApB,EAAuB;AACrBF,YAAMK,WAAN,GAAoB,CAACL,MAAMM,UAAP,CAApB;AACAN,YAAMO,OAAN,GAAgB,EAAhB;AACAP,YAAMO,OAAN,CAAcP,MAAMK,WAAN,CAAkB,CAAlB,CAAd,IAAsCL,MAAMQ,QAA5C;;AAEA;AACA,aAAOR,MAAMQ,QAAb;AACA,aAAOR,MAAMM,UAAb;AACD;;AAED,QAAIJ,gBAAgB,CAApB,EAAuB;AACrB;AACA,aAAOF,MAAMS,eAAb;AACA,aAAOT,MAAMU,QAAb;AACA,aAAOV,MAAMW,SAAb;AACA,aAAOX,MAAMY,MAAb;AACA,aAAOZ,MAAMa,sBAAb;AACD;;AAED,QAAIX,gBAAgB,CAApB,EAAuB;AACrB,UAAIF,MAAMO,OAAN,IAAiB,CAACO,EAAEC,OAAF,CAAUf,MAAMO,OAAhB,CAAtB,EAAgD;AAC9CO,UAAEE,IAAF,CAAOhB,MAAMO,OAAb,EAAsB,UAACU,MAAD,EAAY;AAChCH,YAAEI,YAAF,CAAeD,MAAf,EAAuBE,cAAvB;AACD,SAFD;AAGD;AACF;;AAED,WAAOnB,KAAP;AACD;;gCApCeD,kB;;AAsChB,WAASI,gBAAT,CAA0BH,KAA1B,EAAiC;AAC/B,WAAOA,MAAME,aAAN,IAAuB,CAA9B;AACD;;AAED,WAASD,YAAT,CAAsBD,KAAtB,EAA6B;AAC3B,WAAO,CAACA,MAAMM,UAAP,IAAqB,CAACN,MAAMK,WAA5B,IAA2C,CAACL,MAAMQ,QAAlD,IAA8D,CAACR,MAAMO,OAA5E;AACD;;;AAlDMO,O;;AACCK,oB,wBAAAA,c;;;wCAGKf,sB,GAAyB,C","file":"migrations.js","sourcesContent":["import _ from 'lodash';\r\nimport {DEFAULT_TARGET} from './triggers_panel_ctrl';\r\n\r\n// Actual schema version\r\nexport const CURRENT_SCHEMA_VERSION = 4;\r\n\r\nexport function migratePanelSchema(panel) {\r\n  if (isEmptyPanel(panel)) {\r\n    return panel;\r\n  }\r\n\r\n  const schemaVersion = getSchemaVersion(panel);\r\n  panel.schemaVersion = CURRENT_SCHEMA_VERSION;\r\n\r\n  if (schemaVersion < 2) {\r\n    panel.datasources = [panel.datasource];\r\n    panel.targets = {};\r\n    panel.targets[panel.datasources[0]] = panel.triggers;\r\n\r\n    // delete old props\r\n    delete panel.triggers;\r\n    delete panel.datasource;\r\n  }\r\n\r\n  if (schemaVersion < 3) {\r\n    // delete old props\r\n    delete panel.lastChangeField;\r\n    delete panel.ageField;\r\n    delete panel.infoField;\r\n    delete panel.scroll;\r\n    delete panel.hideHostsInMaintenance;\r\n  }\r\n\r\n  if (schemaVersion < 4) {\r\n    if (panel.targets && !_.isEmpty(panel.targets)) {\r\n      _.each(panel.targets, (target) => {\r\n        _.defaultsDeep(target, DEFAULT_TARGET);\r\n      });\r\n    }\r\n  }\r\n\r\n  return panel;\r\n}\r\n\r\nfunction getSchemaVersion(panel) {\r\n  return panel.schemaVersion || 1;\r\n}\r\n\r\nfunction isEmptyPanel(panel) {\r\n  return !panel.datasource && !panel.datasources && !panel.triggers && !panel.targets;\r\n}\r\n"]}